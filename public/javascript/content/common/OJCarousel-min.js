class OJCarousel{constructor(a={}){a={carouselSelector:"#carousel",slideSelector:".slide",defaultActive:0,mobileDragBorder:.2,doAutoMove:!0,slideTimeout:6e3,pauseTimeout:5e3,animationTimeout:600,dragCursor:"grabbing",undragCursor:"",height:$(window).height(),previousSlideButtonSelector:"#previous-slide-btn",nextSlideButtonSelector:"#next-slide-btn",fallPercentagePreprocessor:a=>a,movePercentagePreprocessor:a=>a,...a},this.initProperties();let b=$(a.carouselSelector).first();this.elements={carousel:b,slides:b.find(a.slideSelector),previousSlideButton:$(a.previousSlideButtonSelector),nextSlideButton:$(a.nextSlideButtonSelector)},this.timeouts={slide:a.slideTimeout,pause:a.pauseTimeout,animation:a.animationTimeout},this.cursors={drag:a.dragCursor,undrag:a.undragCursor},this.percentagePreprocessors={move:a.movePercentagePreprocessor,fall:a.fallPercentagePreprocessor},this.active=a.defaultActive,this.mobileDragBorder=a.mobileDragBorder,this.doAutoMove=a.doAutoMove,this.height=a.height,this.init()}initProperties(){this.slideCache={},this.timers={slide:void 0,auto:void 0},this.isSwitchable=!0,this.isDragging=!1,this.originalX=0,this.width=0}init(){this.elements.slides.css("transform","translateX(100%)"),this.count=this.elements.slides.length,this.recacheSlides(),this.currentPercentage=0;for(let a of this.elements.carousel.find("*"))a.setAttribute("draggable","false"),a.onselectstart=()=>!1,a.ondragstart=()=>!1;for(let a of this.elements.slides)a.addEventListener("mousedown",a=>{this.onStartDrag(a)},{passive:!0}),a.addEventListener("touchstart",a=>{this.onPrepareDragMobile(a)},{passive:!0}),a.addEventListener("touchmove",a=>{this.onDragMobile(a)},{passive:!0});$(window).on({"mousemove.ojcarousel":a=>{this.onDrag(a)},"mouseup.ojcarousel touchend.ojcarousel":a=>{this.onStopDrag(a)}}),$(this.elements.previousSlideButton).on("click.ojcarousel",()=>{this.isSwitchable&&(this.isSwitchable=!1,this.stop(),this.move(-1),this.start(this.timeouts.pause+this.timeouts.animation))}),$(this.elements.nextSlideButton).on("click.ojcarousel",()=>{this.isSwitchable&&(this.isSwitchable=!1,this.stop(),this.move(1),this.start(this.timeouts.pause+this.timeouts.animation))})}set height(a){this.elements.carousel.css("height",a)}get currentPercentage(){return+this.slideCache.active.attr("style").match(/translateX\((.+?)%\)/i)[1]}set currentPercentage(a){this.transform(this.slideCache.next,a+100),this.transform(this.slideCache.active,a),this.transform(this.slideCache.previous,a-100)}start(a=this.timeouts.pause){return this.timers.auto=setTimeout(()=>{this.autoMove()},a),this}pause(){return clearTimeout(this.timers.auto),this}inanimate(){return cancelAnimationFrame(this.timers.slide),this}stop(){return this.pause().inanimate(),this}validate(a){return Math.cycle(this.active+a,this.count)}setCursor(a=this.cursors.undrag){$("html:first").add(this.elements.carousel).css("cursor",a)}autoMove(){this.doAutoMove&&(this.isSwitchable=!1,this.move(1),this.timers.auto=setTimeout(()=>{this.stop(),this.autoMove()},this.timeouts.slide+this.timeouts.animation))}move(a){this.currentPercentage=0,this.active=this.validate(a),this.recacheSlides();let b=performance.now();this.timers.slide=requestAnimationFrame(c=>{this.translate(100*Math.sign(a),b,b+this.timeouts.animation,c,this.percentagePreprocessors.move)})}translate(a,b,c,d,e){if(d<=c){let f=e(a*(1-(d-b)/(c-b)));this.currentPercentage=Math.bound(f,0,a),this.timers.slide=requestAnimationFrame(d=>{this.translate(a,b,c,d,e)})}else this.currentPercentage=0,this.isSwitchable=!0}transform(a,b){a.css("transform",`translateX(${b}%)`)}fall(){let a=performance.now(),b=Math.abs(.01*(this.timeouts.animation*this.currentPercentage));requestAnimationFrame(c=>{this.translate(this.currentPercentage,a,a+b,c,this.percentagePreprocessors.fall)})}recacheSlides(){this.slideCache.previous=$(this.elements.slides[this.validate(-1)]),this.slideCache.active=$(this.elements.slides[this.active]),this.slideCache.next=$(this.elements.slides[this.validate(1)])}moveSlide(a){if(50<Math.abs(a)){let b=Math.sign(a);this.active=this.validate(-b),a-=100*b,this.originalX+=this.width*b,this.recacheSlides()}this.currentPercentage=a}onStartDrag(a){this.isDragging||(this.stop(),this.isDragging=!0,this.width=this.elements.carousel.width(),this.originalX=a.screenX-.01*(this.width*this.currentPercentage),this.recacheSlides(),this.setCursor(this.cursors.drag))}onPrepareDragMobile(a){this.originalX=a.touches[0].clientX}onDrag(a){this.isDragging&&this.moveSlide(100*(a.screenX-this.originalX)/this.width)}onDragMobile(a){a.screenX=a.touches[0].clientX,this.isDragging?this.onDrag(a):Math.abs(a.screenX-this.originalX)/this.width>this.mobileDragBorder&&this.onStartDrag(a)}onStopDrag(){this.isDragging&&(this.isDragging=!1,this.setCursor(),this.fall(),this.start(this.timeouts.pause+this.timeouts.animation))}kill(a={}){a={clearTimeouts:!0,clearEvents:!0,...a},this.setCursor(),a.clearTimeouts&&this.stop(),a.clearEvents&&(this.elements.carousel.html(this.elements.carousel.html()),$(window).add(this.elements.previousSlideButton).add(this.elements.nextSlideButton).off(".ojcarousel"))}}